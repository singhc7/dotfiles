# --- HARDWARE DECODING ---

# Explicitly use VAAPI to stop it from looking for Nvidia (CUDA) drivers
hwdec=vaapi
vo=gpu
gpu-context=wayland

# --- YOUTUBE STRICT RULES ---

# This forces YouTube to send the 'vp9' codec. 
ytdl-format="bestvideo[vcodec*=vp9]+bestaudio/best"


# --- UI SETTINGS ---
keep-open=yes
osd-on-seek=msg-bar

# --- NETWORK & CACHE ---

# Prefetch 100MB of video to memory. Prevents buffering on spotty WiFi.
# Good for 4K streams.
demuxer-max-bytes=100MiB
demuxer-max-back-bytes=50MiB

# --- SCREENSHOTS ---

# Save high-quality PNGs to your Pictures folder when you press 's'
screenshot-format=png
screenshot-high-bit-depth=yes
screenshot-png-compression=7
screenshot-directory=~/Pictures/mpv_shots

# --- OSD (On Screen Display) ---

# Make the UI text cleaner and the bar smaller
osd-font='Sans Serif'
osd-font-size=30
osd-bar-h=2
osd-border-size=1




# --- MUSIC MODE PROFILE ---

[music]

# --- CORE ---

# Force audio only, but grab the absolute best bitrate available (usually Opus ~160k+)
ytdl-format=best
video=no
force-window=no

# 1. Tell mpv not to load subs even if they exist
sub=no

# 2. Tell yt-dlp to NOT even look for subtitles
ytdl-raw-options-append=no-write-sub=
ytdl-raw-options-append=no-write-auto-sub=

# --- THE HIGH END AUDIO TWEAKS ---

# 1. PipeWire Native Backend
# Uses the modern Fedora audio server directly for lower latency and better mixing.
ao=pipewire

# 2. Gapless Playback
# Prevents that awkward silence between songs. Essential for albums/mixes.
gapless-audio=yes

# 3. High-Quality Resampling

# If the audio hz doesn't match the DAC/Headphones, this uses the 
# high-quality 'soxr' library instead of the basic linear interpolation.
# Uses slightly more CPU.
audio-samplerate=48000
audio-channels=stereo

# 4. Dynamic Normalization (The "Radio" Experience)

# Smooths out loud/quiet tracks 
# without crushing the dynamic range too hard.
af=lavfi=[dynaudnorm=f=75:g=25:p=0.55]

# 5. Buffer Tuning for Quality (Anti-Stutter)

# 2. Force the cache to dump data immediately after playing it
# 3. STRICTLY forbid going over the cache limit (even by 1 byte)
cache=yes
demuxer-max-bytes=10M   
demuxer-max-back-bytes=1M
demuxer-hysteresis-secs=0

# --- META ---

# Prevent album art from spawning a window (common annoyance)
audio-display=no

# TELL YOUTUBE: "I am the YouTube Music android App"
ytdl-raw-options-append=extractor-args=youtube:player_client=android_music
